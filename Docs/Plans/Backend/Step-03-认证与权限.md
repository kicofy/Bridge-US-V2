# Step 03 认证与权限

## 目标
实现登录注册、JWT 访问与刷新机制，以及基础角色权限控制。

## 前置条件
- Step 02 完成

## 详细任务拆解
1. 认证流程
   - 注册、登录、登出、密码重置
   - access/refresh 令牌签发与续签
2. 会话管理
   - `user_sessions` 记录 refresh token 哈希
   - 退出时失效 refresh token
   - 单设备/多设备策略明确
3. 权限体系
   - `user`、`moderator`、`admin`
   - 权限依赖与路由保护
   - 管理员接口统一前缀 `/admin/*`
4. 安全细节
   - 登录限流
   - 密码哈希存储（bcrypt/argon2）
   - 访问令牌短期有效，刷新令牌长期有效
5. 认证错误规范
   - 401/403 响应格式统一
   - 令牌过期与无效区分

## 产出物
- `/auth/*` 接口可用
- 认证中间件与权限依赖
- 会话记录与刷新机制

## 验收标准
- access 过期可用 refresh 换新
- 未授权访问受限接口被拒绝
- 登出后 refresh 失效

## 风险与注意
- refresh token 必须存储哈希
- 管理员接口需强制 RBAC

